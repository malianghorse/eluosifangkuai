var JSPVZ,AutoSun,NumZombies=FlagZombies=Chose=MCID=0,ChoseCard,MPID="",obDAll,obTSunNum,DShadow,$User=function(){var a=navigator.platform,e=navigator.userAgent,c=(a=="Win32"||a=="Windows"),d=(a=="Mac68K"||a=="MacPPC"||a=="Macintosh"),b=(a=="X11"&&!c&&!d),f=c||d||b;return{Browser:{IE:!!(window.attachEvent&&!window.opera),IE6:!!(window.attachEvent&&!window.opera)&&!window.XMLHttpRequest,Opera:!!window.opera,WebKit:e.indexOf("AppleWebKit/")>-1,Gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")==-1},System:{Win:c,Mac:d,Unix:b},Client:{PC:f,Mobile:!f},HTTP:location.protocol.toLowerCase()=="http:"?1:0}}(),oSym={Now:0,TQ:[],Timer:null,execTask:null,Init:function(b,a){this.TQ=[{T:0,f:b,ar:a||[]}];this.Start()},Clear:function(){this.TQ.length=0},Start:function(){this.Timer=setInterval(function(){try{++oSym.Now}catch(a){alert("超时退出游戏");location.reload()}},10);(function(){var d=oSym,a=d.TQ,c=a.length,b,e;while(c--){d.Now>=(b=a[c]).T&&((e=b.f).apply(e,b.ar),d.removeTask(c))}d.execTask=setTimeout(arguments.callee,10)})()},Stop:function(){clearInterval(this.Timer);clearTimeout(this.execTask);this.Timer=null},addTask:function(b,c,a){var d=this.TQ;d[d.length]={T:this.Now+b,f:c,ar:a};return this},removeTask:function(a){this.TQ.splice(a,1);return this}},ShadowPNG="images/plantshadow"+($User.Browser.IE6?(document.execCommand("BackgroundImageCache",false,true),"8.gif"):"32.png"),innerText=$User.Browser.IE?function(b,a){b.innerText=a}:function(b,a){b.textContent=a},$Pn=[],$Z=[],$P=[],CoordLawn=function(){ChosePlantX=function(a){return Compare(GetC(a),1,oS.C,GetX)};ChosePlantY=function(a){return $SSml(a,[86,181,281,386,476],[[75,0],[175,1],[270,2],[380,3],[470,4],[575,5]])};GetC=function(a){return $SSml(a,[100,140,220,295,379,460,540,625,695,775,855,935],[-1,0,1,2,3,4,5,6,7,8,9,10,11])};GetR=function(a){return $SSml(a,[86,181,281,386,476],[0,1,2,3,4,5])};GetX=function(a){return $SEql(a,{"-1":100,0:140,1:187,2:267,3:347,4:427,5:507,6:587,7:667,8:747,9:827,10:865,11:950})};GetY=function(a){return $SEql(a,{0:75,1:175,2:270,3:380,4:470,5:575})};GetY1Y2=function(a){return $SEql(a,{0:[0,85],1:[86,180],2:[181,280],3:[281,385],4:[386,475],5:[476,600]})};!oS.InitLawnMower&&(oS.InitLawnMower=function(){var a=6,b=oGd.$LM;while(--a){b[a]=1;NewImg("LawnMower"+a,"images/LawnMower.gif","left:"+oS.LawnMowerX+"px;top:"+(GetY(a)-60)+"px;z-index:"+(3*a+2),1)}})},oS={PicArr:[],W:900,H:600,R:5,C:9,PName:[],ZName:[],AccessNum:0,PicNum:0,SunNum:50,DKind:1,backgroundImage:"",LF:[0,1,1,1,1,1],CanSelectCard:1,CanSelectZombies:[],LargeWaveFlag:{},StaticCard:1,LawnMowerX:70,Init:function(c,d,b){for(b in c){this[b]=c[b]}d&&oP.Init(d);var a=this.R;oT.Init(a);oZ.Init(a);oGd.Init();obDAll=$("dAll");obTSunNum=$("tSunNum");this.LoadMusic();(this.Coord||CoordLawn)();this.LoadProgress()},LoadProgress:function(q,k,a){SetStyle($("dFlagMeter"),{left:"50px",top:"280px",visibility:"visible"});SetHidden($("imgGQJC"));var m=oS,i=[],h=m.PicArr,j=m.PName,r=m.ZName,t=0,c=document.createTextNode("正在准备载入游戏素材。。。"),s=GetX(11),f=oGd.$LF,b=oS.R+1,d=m.LoadImage,g=m.CheckImg,e=m.InitPn,l,p;innerText($("sFlagMeterTitleF"),c.data);$("dFlagMeterTitleB").insertBefore(c,$("sFlagMeterTitleF"));t+=(q=j.length);while(q--){a=(k=j[q].prototype).PicArr.slice(0);i[i.length]=[k.EName,a[k.NormalGif],k.getShadow(k)];a.splice(k.NormalGif,1);Array.prototype.push.apply(h,a)}for(q in oS.LargeWaveFlag){r[r.length]=oFlagZombie;break}q=r.length;while(q--){Array.prototype.push.apply(h,(k=(p=r[q]).prototype).PicArr.slice(0));k.Init.call(p,s,k,f,b)}m.PicNum=t+=h.length;q=h.length;while(q--){d(h[q],g)}q=i.length;while(q--){d((l=i[q])[1],e,l)}},InitPn:function(a){var b;$Pn[a[0]]=b=NewEle(0,"div","position:absolute");b.appendChild(NewImg(0,ShadowPNG,a[2]));b.appendChild(NewImg(0,a[1]));oS.CheckImg()},LoadImage:$User.Browser.IE?function(b,d,c){var a=new Image();a.onreadystatechange=function(){(a.readyState=="complete"||a.readyState=="loaded")&&d(c)};a.onerror=function(){a.onreadystatechange=null;a.title=b;d(c)};a.src=b}:function(b,d,c){var a=new Image();a.complete?d(c):a.onload=function(){d(c)};a.onerror=function(){a.onreadystatechange=null;a.title=b;d(c)};a.src=b},CheckImg:function(b,a){var c=oS;b=139-c.AccessNum++*140/c.PicNum-11;$("imgFlagHead").style.left=b+"px";a="载入:("+c.AccessNum+"/"+c.PicNum+")";innerText($("sFlagMeterTitleF"),a);$("dFlagMeterTitleB").firstChild.data=a;$("imgFlagMeterFull").style.clip="rect(0,auto,21px,"+(b+11)+"px)";if(c.AccessNum==c.PicNum){SetHidden($("dFlagMeterContent"),$("dFlagMeter"));SetStyle($("dFlagMeter"),{left:"260px",top:"560px"});innerText($("sFlagMeterTitleF"),$("dFlagMeterTitleB").firstChild.data=c.LevelName);$("imgFlagHead").style.left="139px";$("imgFlagMeterFull").style.clip="rect(0,auto,auto,157px)";(AutoSun=$User.Client.PC?Math.floor(getCookie("JSPVZAutoSun")):1)&&($("cAutoSun").checked=true);delete c.LoadMusic;delete c.PicArr;delete c.Coord;delete c.LF;(c.LoadAccess||function(){NewImg("imgGrowSoil","images/interface/GrowSoil.png","position:absolute;display:none;z-index:50",1);NewEle("dTitle","div",0,0,1);innerText(obTSunNum,c.SunNum);SetNone($("dSelectModal"));SetStyle($("tGround"),{background:"url("+c.backgroundImage+") no-repeat",display:"block"});InitPCard();oSym.addTask(100,function(){var d=obDAll.scrollLeft+=25;d<500?oSym.addTask(2,arguments.callee,[]):(DisplayZombie(),SetBlock($("dMenu")),oS.CanSelectCard?(SetBlock($("dTop"),$("dSelectCard")),SetVisible($("dCardList"))):(AutoSelectCard(),oSym.addTask(200,LetsGO,[])))},[])})()}}},oGd={Init:function(){this.$=[];this.$Crater=[];this.$Torch=[];this.$LF=oS.LF;this.$LM=[];this.$B=[]},add:function(c,a,b,d){(b=(d=this.$)[a])&&b.Die();d[a]=c},del:function(a){delete this.$[a.R+"_"+a.C+"_"+a.PKind]},MoveBullet:function(){var d=oGd.$B,a=d.length,c,b=oGd.$Torch;while(a--){(c=d[a]).F(c,a,d,b)}oSym.addTask(1,arguments.callee,[])},MB1:function(e,j,m,f){var d=e.id,k=$(d),h=e.Attack,a=e.D,p,q=e.X,c=GetC(q),g=e.R,n=e.Kind,l=e.ChangeC,b=oZ.getZ(q,g,a);n<1&&f[g+"_"+c]&&l!=c&&((e.Kind=++n)&&(h=e.Attack=40),e.ChangeC=c,k.src="images/Plants/PB"+n+a+".gif");b&&b.Altitude==1?(b.getHurt(-1,a,h,n,0,0,0),m.splice(j,1),EditEle(k,{src:"images/Plants/PeaBulletHit.gif"},{left:e.pixelLeft+28+"px"}),oSym.addTask(10,ClearChild,[k])):(e.X+=(p=!a?5:-5))<oS.W&&e.X>100?k.style.left=(e.pixelLeft+=p)+"px":(m.splice(j,1),ClearChild(k))},MB2:function(d,g,h){var c=d.id,j=d.X,a=GetC(j),f=d.R,b=oZ.getZ(j,f,0),e=$(c);b&&b.Altitude==1?(b.getHurt(-1,0,20,0,0,0,0),h.splice(g,1),EditEle(e,{src:"images/Plants/ShroomBulletHit.gif"},{left:d.pixelLeft+38+"px"}),oSym.addTask(10,ClearChild,[e])):(d.X+=5)<oS.W?e.style.left=(d.pixelLeft+=5)+"px":(h.splice(g,1),ClearChild(e))},MB3:function(g,d,a){var h=g.id,b=$(h),f=oZ.getZ(g.X,g.R,0),e=g.D,c=g.pixelTop;if(f&&f.Altitude==1){f.getHurt(-1,0,20,0,0,0,0);a.splice(d,1);ClearChild(b)}else{switch(g.D){case 4:(g.X-=5)<100?(a.splice(d,1),ClearChild(b)):b.style.left=(g.pixelLeft-=5)+"px";break;case 6:(c=g.pixelTop-=5)<-15?(a.splice(d,1),ClearChild(b)):(b.style.top=c+"px",g.R=GetR(c+15));break;case 2:(c=g.pixelTop+=5)>600?(a.splice(d,1),ClearChild(b)):(b.style.top=c+"px",g.R=GetR(c+15));break;case 7:(g.X+=4.3)>900||(c=g.pixelTop-=5)<-15?(a.splice(d,1),ClearChild(b)):(g.R=GetR(c+15),b.style.left=(g.pixelLeft+=9.6)+"px",b.style.top=c+"px");break;case 1:(g.X+=4.3)>900||(c=g.pixelTop+=5)>600?(a.splice(d,1),ClearChild(b)):(g.R=GetR(c+15),b.style.left=(g.pixelLeft+=9.6)+"px",b.style.top=c+"px")}}}},oZ={Init:function(b){this.$=[];this.$R=[];var a;for(a=b;a;this.$[a]=[],this.$R[a--]=[]){}},add:function(b,a){(a=this.$[b.R]).push(b);a.sort(function(d,c){return d.AttackedLX-c.AttackedLX});a.RefreshTime=new Date},getZ:function(k,b,g){var e=0,m=this.$[b],h=this.$R[b],j,c,l,f;if(!g){f=(j=m).length;while(e<f&&(c=j[e++]).AttackedLX<=k){if(c.HP&&c.AttackedRX>=k){return c}}}else{(l=m.RefreshTime)==h.RefreshTime?j=h:(j=(this.$R[b]=m.slice(0)).sort(function(i,d){return d.AttackedRX-i.AttackedRX})).RefreshTime=l;f=j.length;while(e<f&&(c=j[e++]).AttackedRX>=k){if(c.HP&&c.AttackedLX<=k){return c}}}return},getArZ:function(e,d,b){var g=0,l=this.$[b],f=[],k=0,c,h=l.length,j;while(g<h&&(j=(c=l[g++]).AttackedLX)<d){c.HP&&(j>e||c.AttackedRX>e)&&(f[k++]=c)}return f},moveTo:function(g,f,c){var b=this.$[f],a=this.$[c],e=b.length,d;while(e--){(o=b[e]).id==g&&(b.splice(e,1),o.R=c,a.push(o),(a.sort(function(i,h){return i.AttackedLX-h.AttackedLX})).RefreshTime=b.RefreshTime=new Date,e=0)}},traversalOf:function(){var c,i,h,g,a=new Date,b,e=this.$,n,m=Refresh=0,l=1000,k,j,d=function(q,p){p?(k=q.AttackedLX)>l&&(m=Refresh=1):Refresh=1;l=k},f=e.length;(function(r){var q=(n=e[r]).length,p=arguments.callee;while(q--){c=n[q];if(!c.HP){n.splice(q,1);d(c,0);continue}else{c.ZX<901&&oT.check(c);if(!c.HP){n.splice(q,1);d(c,0);continue}}i=c.FreeFreezeTime;h=c.FreeSetbodyTime;j=c.id;switch(true){case !i&&!h:c.beAttacked&&!c.isAttacking&&c.JudgeAttack();break;default:i&&a>=i&&(c.FreeFreezeTime=i="");h&&a>=h&&(c.FreeSetbodyTime=h="");if(i||h){d(c,1);continue}else{c.JudgeAttack()}}(g=c.FreeSlowTime)&&a>=g&&(c.Speed=c.OSpeed,c.FreeSlowTime="");if(!c.isAttacking){b=c.Speed;if(!c.WalkDirection){if(GetC(c.ZX=c.AttackedLX-=b)){if((c.AttackedRX-=b)<100){GameOver();oSym.Stop();return}}else{if(oGd.$LM[r]){n.splice(q,1);c.Die(2);LawnMowerKill(r);d(c,0);continue}}$(j).style.left=Math.floor(c.X-=b)+"px"}else{if((c.AttackedLX+=b)>oS.W){n.splice(q,1);c.Die(2);d(c,0);continue}c.ZX=c.AttackedRX+=b;$(j).style.left=Math.ceil(c.X+=b)+"px"}}d(c,1)}m?(m=0,n.sort(function(t,s){return t.AttackedLX-s.AttackedLX}),n.RefreshTime=new Date):Refresh&&(n.RefreshTime=new Date);--r&&setTimeout(function(){p(r)},0)})(e.length-1)}},oT={Init:function(b){this.$=[];this.$L=[];for(var a=b;a;){this.$[a]=[];this.$L[a--]=[]}},add:function(f,c,g){var e=this.$[f],d=c.length,b;while(d--){b=c[d];e.push([b[0],b[1],b[2],g])}e.sort(function(i,h){return h[1]-i[1]});e.RefreshTime=new Date},check:function(b,l,k,e,a,j,c){var h=b.AttackedLX,f=b.AttackedRX,d=0,g=this.$[c=b.R];if(!b.WalkDirection){while(d<g.length&&(e=g[d])[1]>=h){(a=$P[e[3]]).canTrigger&&e[0]<=h&&a.TriggerCheck(b,e[2],d);++d}}else{(k=g.RefreshTime)==(j=this.$L[c]).RefreshTime?l=j:(l=(this.$L[c]=g.slice(0)).sort(function(m,i){return m[0]-i[0]})).RefreshTime=k;while(d<l.length&&(e=l[d])[0]<=f){(a=$P[e[3]]).canTrigger&&e[1]>=f&&a.TriggerCheck(b,e[2],d);++d}}},delP:function(e){var b=e.oTrigger,f=e.id,d,a,c;for(d in b){for(c=(a=this.$[d]).length;c--;a[c][3]==f&&a.splice(c,1)){}a.RefreshTime=new Date}},indexOf:function(j,d){var f=new RegExp(d+",","g"),h=(j.toString()+",").replace(f,"┢,").replace(/[^,┢]/g,""),i=0,g=0,b=[];for(;(g=h.indexOf("┢",g))>0;b.push((g++-i++-2)/3)){}return b}},asyncInnerHTML=function(d,c,a){var b=$n("div"),e=document.createDocumentFragment();b.innerHTML=d;(function(g){var f=arguments.callee;g--?(e.appendChild(b.firstChild),setTimeout(function(){f(g)},0)):c(e,a)})(b.childNodes.length)},oP={Init:function(b){var a;for(a in b){this[a]=b[a]}this.LAr=this.ArZ.length;this.FlagHeadStep=Math.floor(140/(b.FlagNum-1));this.SelectFlagZombie=function(h){var i=oP,g=[],e=0,j=i.ArZ,k=oS.LargeWaveFlag[FlagZombies],m=i.SumToZombie,d=m.a1,c=m.a2,f;f=!k?1500:(k.style.top="5px",--h,g[e++]=oFlagZombie,300);while(h>0){h-=(g[e++]=j[Math.floor(Math.random()*$SGrt(h,d,c))]).prototype.Lvl}NumZombies+=e;i.SetTimeoutZombie(g,f)},this.SetTimeoutZombie=function(d,f){var h=[],e=[],g=delayT=0,c=d.length;while(g<c){e[g]=(h[g]=new d[g]).prepareBirth(delayT);delayT+=f;++g}asyncInnerHTML(e.join(""),function(l,k){var j=k.length;while(j--){k[j].Birth()}obDAll.appendChild(l)},h)},this.AddZombiesFlag=function(g){var i=oP,e=oS.LargeWaveFlag,h,d=i.FlagHeadStep,c=i.FlagNum;SetVisible($("imgGQJC"),$("dFlagMeterContent"),$("dFlagMeterTitle"));for(h in e){Math.floor(h)<c?SetStyle(e[h],{display:"block",left:(150-(h-1)*d)+"px"}):SetBlock(e[h])}oGd.MoveBullet();i.ReadyFlag=1;i.FlagPrgs(g)},this.FlagPrgs=function(){var g=oP,f=g.FlagToSumNum,c=139-FlagZombies*g.FlagHeadStep,e=$SSml(FlagZombies,f.a1,f.a2),d;g.FlagNum>++FlagZombies?($("imgFlagHead").style.left=c+"px",$("imgFlagMeterFull").style.clip="rect(0,157px,21px,"+(c+11)+"px)",(d=$SEql(FlagZombies,g.FlagToMonitor))&&oSym.addTask(1690,function(h){!h[1]&&(h[0](),h[1]=1)},[d]),oSym.addTask(2490,function(h){var i=oP;i.ReadyFlag==h++&&(i.ReadyFlag=h,i.FlagPrgs())},[FlagZombies])):($("imgFlagHead").style.left="-1px",$("imgFlagMeterFull").style.clip="rect(0,157px,21px,0)");g.SelectFlagZombie.call(g,e);g.UserDefinedFlagFunc&&g.UserDefinedFlagFunc()},this.MonPrgs=function(){var d=oP,c;!--NumZombies&&(FlagZombies<d.FlagNum?(d.ReadyFlag=FlagZombies+1,(c=$SEql(FlagZombies,d.FlagToMonitor))&&(c[0](),c[1]=1),oSym.addTask(500,d.FlagPrgs,[])):(d.FlagToEnd(),oSym.Stop()))},this.Monitor=function(c,d){c&&c.f.apply(c.f,c.ar);d&&(oP.UserDefinedFlagFunc=d);(function(){oZ.traversalOf();oSym.addTask(10,arguments.callee,[])})()}}},WhichMouseButton=function(a){a=window.event||a;var b=$User.Browser;return !b.Gecko?$SEql(a.button,{1:1,0:b.IE?2:1,2:2,"default":1}):$SEql(a.which,{1:1,3:2,"default":1})},GroundOnmousedown=function(i){i=window.event||i;var a=i.clientX,j=i.clientY+document.body.scrollTop,g=ChosePlantX(a),h=ChosePlantY(j),d=g[0],c=h[0],f=h[1],b=g[1];switch(Chose){case 1:WhichMouseButton(i)<2?GrowPlant(GetAP(a,j,f,b)[0],d,c,f,b):CancelPlant();break;case -1:WhichMouseButton(i)<2?ShovelPlant(GetAP(a,j,f,b)):CancelShovel()}},GetAP=function(a,h,d,c){var f,i=oGd.$,e,g=[],b;for(f=0;f<4;g.push(e=i[d+"_"+c+"_"+f++]),e&&!(a<e.pixelLeft||a>e.pixelRight||h<e.pixelTop||h>e.pixelBottom)&&(b=e)){}return[g,b]},GroundOnkeydown=function(a){if((a||event).keyCode==27){switch(Chose){case 1:CancelPlant();break;case -1:CancelShovel()}return false}},GroundOnmousemove=function(k){k=window.event||k;var d=k.clientX,b=k.clientY+document.body.scrollTop,h=ChosePlantX(d),i=ChosePlantY(b),f=h[0],c=i[0],g=i[1],a=h[1],n=GetAP(d,b,g,a);switch(Chose){case 1:var m=ArCard[ChoseCard].PName.prototype;SetStyle($("MovePlant"),{left:d-m.width*0.5+"px",top:b+20-m.height+"px"});m.CanGrow(n[0],g,a)?SetStyle($("MovePlantAlpha"),{display:"block",left:f+m.GetDX()+"px",top:c-m.height+m.GetDY(g,a,n[0])+"px"}):SetNone($("MovePlantAlpha"));break;case -1:var j=n[1],l=j?j.id:"";MPID!=l&&(MPID&&SetAlpha($(MPID).childNodes[1],100,1),(MPID=l)&&SetAlpha($(l).childNodes[1],60,0.6));SetStyle($("tShovel"),{left:d-15+"px",top:b-16+"px"})}},ViewProducePlant=function(b){var a=b.prototype;$("pHandBookPlant").src=a.PicArr[a.NormalGif];$("tdProducePlant").innerHTML=a.Produce;innerText($("tdHandBookPlantName"),a.CName);innerText($("spSunNum"),a.SunNum);innerText($("spCoolTime"),a.coolTime*0.001+"秒")},ViewProduceZombie=function(b){var a=b.prototype;$("pHandBookZombie").src=a.PicArr[a.NormalGif];$("tdProduceZombie").innerHTML=a.Produce;innerText($("tdHandBookZombieName"),a.CName)},DisplayZombie=function(){var b=oP.ArZ.slice(0),a=l2=b.length,e,f=$("dZombie"),d=[],c=[];while(a--){d.push(Math.floor(150+Math.random()*444))}d.sort(function(h,g){return h-g});while(l2){e=b[Math.floor(Math.random()*l2)].prototype;c[l2--]=e.getHTML("",Math.floor(50+Math.random()*201)-e.width*0.5,d[l2]-e.height,1)}asyncInnerHTML(c.join(""),function(g){f.appendChild(g)})},ArCard=[],ArPCard=[],AutoSelectCard=function(){var c=oS.PName,b=-1,a=c.length;while(++b<a){SelectCard(c[b].prototype.EName)}},InitPCard=function(){var d="",f,e=oS.PName,a=e.length,b=0,c;while(b<a){f=e[b];c=f.prototype;ArPCard[EName=c.EName]={Select:0,PName:f};d+='<span class="span1" id="Card'+EName+'" onmouseout="SetNone($(\'dTitle\'))" onmousemove="ViewCardTitle(\''+EName+"',event)\" onclick=\"SelectCard('"+EName+'\')"><img src="'+c.PicArr[c.CardGif]+'"><span class="span2">'+c.SunNum+"</span></span>";b++%6==5&&(d+="<br>")}$("dPCard").innerHTML=d},ViewCardTitle=function(b,c){c=c||window.event;var f=$("dTitle"),a=ArPCard[b].PName.prototype;f.innerHTML=a.CName+"<br>冷却时间:"+(a.coolTime*0.001).toFixed(1)+"秒<br>"+a.Tooltip;SetStyle(f,{left:c.clientX+obDAll.scrollLeft-3+"px",top:c.clientY+18+"px",display:"block"})},SelectCard=function(f){var a=$("Card"+f).firstChild,i=ArPCard[f],c=i.PName.prototype,h,e,b,g=$("btnOK");if(!i.Select){if(!(ArPCard.SelNum|=0)){g.disabled="";g.style.color="#FC6"}else{if(ArPCard.SelNum>9){return}}++ArPCard.SelNum;i.Select=1;oS.StaticCard&&($("dCardList").appendChild(h=NewEle("dCard"+f,"div",0,{onclick:function(){SelectCard(f)}})),(e=$n("img")).src=a.src,h.appendChild(e),h.appendChild(b=NewEle("sSunNum"+f,"span")),innerText(b,c.SunNum),a.src=c.PicArr[c.CardGif+1])}else{i.Select=0;!--ArPCard.SelNum&&(g.disabled="disabled",g.style.color="#888");e=(h=$("dCard"+f)).firstChild;b=h.lastChild;$("dCardList").removeChild(h);h.removeChild(e);h.removeChild(b);e=null;b=null;h.onclick=null;h=null;a.src=c.PicArr[c.CardGif]}},ResetSelectCard=function(){var a;for(a in ArPCard){ArPCard[a].Select&&SelectCard(a)}$("btnOK").disabled="disalbed";$("btnOK").style.color="#888"},LetsGO=function(){var b=$("dZombie"),f=$("dCardList"),h=0,l=f.childNodes.length,g,j,m,e,k,a,c=$("dBody");while(b.hasChildNodes()){b.removeChild(k=b.lastChild);k=null}SetNone(b,$("dSelectCard"));$("tGround").style.left="-115px";obDAll.scrollLeft=0;SetStyle($("dTop"),{left:"105px",top:0});f.style.left=0;while(h<l){(function(d){g=(k=f.childNodes[d]).id.substr(5);m=(j=ArPCard[g].PName).prototype;k.onclick=function(i){ChosePlant(i,d)};k.onmouseover=function(){SetBlock($("dTitle"));ViewPlantTitle(MCID=d)};k.onmouseout=function(){SetNone($("dTitle"))};(a=k.lastChild).id="sSunNum"+d;innerText(a,m.SunNum);k.firstChild.src=m.PicArr[m.CardGif+1];ArCard.push({DID:k.id,CDReady:0,SunReady:0,PName:j})})(h++)}c.onkeydown=function(d){GroundOnkeydown(d)};c.onmousedown=function(d){GroundOnmousedown(d)};c.onmousemove=function(d){GroundOnmousemove(d)};SetVisible(f);(oS.StartGame||function(){ClearChild($("oEmbed"));NewEle("oEmbed","embed","width:0;height:0",{src:"music/UraniwaNi.swf"},1);SetVisible($("tdShovel"),$("dFlagMeter"));SetBlock($("dTop"));oS.InitLawnMower();PrepareGrowPlants(function(){oP.Monitor();BeginCool();AutoProduceSun(25);oSym.addTask(1500,function(){oP.AddZombiesFlag();SetVisible($("dFlagMeterContent"))},[])})})()},ViewPlantTitle=function(b){var f=$("dTitle"),e=ArCard[b],c=e.PName.prototype,a=c.CName+"<br>冷却时间:"+(c.coolTime*0.001).toFixed(1)+"秒<br>"+c.Tooltip;!e.CDReady&&(a+='<br><span style="color:#F00">正在重新装填中...</span>');!e.SunReady&&(a+='<br><span style="color:#F00">阳光不足!</span>');f.innerHTML=a;SetStyle(f,{top:60*b+"px",left:"100px"})},BeginCool=function(){var b=ArCard.length,c,d,a,e;while(b--){a=(c=(d=ArCard[b]).PName.prototype).coolTime;e=c.SunNum;switch(a){case 7500:d.CDReady=1;e<=oS.SunNum&&(d.SunReady=1,$(d.DID).firstChild.src=c.PicArr[c.CardGif]);break;case 30000:DoCoolTimer(b,20000,20000);break;default:DoCoolTimer(b,35000,35000)}}},MonitorCard=function(c){var a=ArCard.length,b;if(Chose<1){while(a--){(b=(c=ArCard[a]).PName.prototype).SunNum>oS.SunNum?(c.SunReady&&(c.SunReady=0),$(c.DID).firstChild.src=b.PicArr[b.CardGif+1]):(!c.SunReady&&(c.SunReady=1),c.CDReady&&($(c.DID).firstChild.src=b.PicArr[b.CardGif]))}}else{while(a--){(b=(c=ArCard[a]).PName.prototype).SunNum>oS.SunNum?c.SunReady&&(c.SunReady=0):!c.SunReady&&(c.SunReady=1)}}ViewPlantTitle(MCID)},DoCoolTimer=function(h,b,g){var e=ArCard[h],f=$(e.DID),d,c,a;b!=g?function(){(b-=500)>0?function(){a=(b*0.001).toFixed(1);innerText($("dCD1"+h),a);innerText($("dCD2"+h),a);oSym.addTask(50,DoCoolTimer,[h,b,g])}():function(){f.removeChild(d=$("dCD1"+h));f.removeChild(c=$("dCD2"+h));d=null;c=null;e.CDReady=1;MonitorCard()}()}():function(){d=NewEle("dCD1"+h,"span","position:absolute;left:22px;top:22px;font-size:15pt;font-weight:500;font-family:Verdana;color:#000");c=NewEle("dCD2"+h,"span","position:absolute;left:20px;top:20px;font-size:15pt;font-weight:500;font-family:Verdana;color:#FF0");f.appendChild(d);f.appendChild(c);a=(b*0.001).toFixed(1);innerText(d,a);innerText(c,a);oSym.addTask(50,DoCoolTimer,[h,b-500,g])}()},ChosePlant=function(h,c){var f=ArCard[ChoseCard=c];if(!(f.CDReady&&f.SunReady)){return}var b=(h=h||event).clientX,a=h.clientY+document.body.scrollTop,j=f.PName.prototype,g,e=ArCard.length,d;Chose=1;g=EditImg($Pn[j.EName].childNodes[1].cloneNode(false),"MovePlant","",{left:b-j.width*0.5+"px",top:a+20-j.height+"px",zIndex:254},1);EditImg(g.cloneNode(false),"MovePlantAlpha","",{display:"none",filter:"alpha(opacity=40)",opacity:0.4,zIndex:30},1);while(e--){$((d=ArCard[e]).DID).firstChild.src=(j=d.PName.prototype).PicArr[j.CardGif+1]}SetNone($("dTitle"))},CancelPlant=function(){ClearChild($("MovePlant"),$("MovePlantAlpha"));Chose=0;MonitorCard()},ShovelPlant=function(a){var b=a[0],c=a[1];c&&(c.PKind||!(b[1]||b[2]))&&(c.Die(),MPID="");CancelShovel()},CancelShovel=function(a){ClearChild($("tShovel"));Chose=0;SetBlock($("imgShovel"));MPID&&SetAlpha($(MPID).childNodes[1],100,1)},ChoseShovel=function(a){WhichMouseButton(a)<2&&(SetNone($("imgShovel")),NewImg("tShovel","images/interface/Shovel.png","left:"+(a.clientX-10)+"px;top:"+(a.clientY+document.body.scrollTop-17)+"px;z-index:1",1),Chose=-1,StopBubble(a))},StopBubble=function(a){window.event?event.cancelBubble=true:a.stopPropagation()},GrowPlant=function(c,h,g,b,f){var e=ArCard[ChoseCard],d=e.PName,a=d.prototype;a.CanGrow(c,b,f)&&((new d).Birth(h,g,b,f,c),innerText(obTSunNum,oS.SunNum-=a.SunNum),$(e.DID).firstChild.src=a.PicArr[a.CardGif+1],e.CDReady=0,DoCoolTimer(ChoseCard,a.coolTime,a.coolTime),SetStyle($("imgGrowSoil"),{left:h-30+"px",top:g-40+"px",zIndex:3*b,display:"block"}),oSym.addTask(20,SetNone,[$("imgGrowSoil")]));CancelPlant()},AutoProduceSun=function(a){AppearSun(GetX(Math.floor(1+Math.random()*oS.C)),GetY(Math.floor(1+Math.random()*oS.R)),a,1);oSym.addTask(Math.floor(9+Math.random()*3)*100,AutoProduceSun,[a])},ArSun=[],AppearSun=function(h,f,e,a){var b,d,g="Sun"+Math.random(),c="cursor:pointer;z-index:25;filter:alpha(opacity=80);opacity:0.8;left:"+h+"px;";switch(e){case 25:c+="width:78px;height:78px";b=39;break;case 15:c+="width:46px;height:46px";b=23;break;default:c+="width:100px;height:100px";b=55}a?(d=0,oSym.addTask(10,MoveDropSun,[g,f])):(d=f-b-20,c+=";top:"+d+"px",oSym.addTask(800,DisappearSun,[g]));ArSun[g]={id:g,N:e,C:1,left:h,top:d};NewImg(g,"images/Sun.gif",c,1,{onclick:function(){ClickSun(this.id)}});AutoSun&&oSym.addTask(100,ClickSun,[g])},MoveDropSun=function(c,b){var a=ArSun[c];a&&a.C&&(a.top<b-53?($(c).style.top=(a.top+=3)+"px",oSym.addTask(5,MoveDropSun,[c,b])):oSym.addTask(800,DisappearSun,[c]))},DisappearSun=function(b){var a=ArSun[b];a&&a.C&&(delete ArSun[b],ClearChild($(b)))},ClickSun=function(c){var a=ArSun[c],b=oS.SunNum;a.C&&(a.C=0,innerText(obTSunNum,oS.SunNum=Math.min(b+a.N,9990)),oSym.addTask(0,MoveClickSun,[c]).addTask(0,MonitorCard,[]))},MoveClickSun=function(b){var a=15,c=ArSun[b],e=85,i=-20,d=c.left,h=c.top,g=Math.round((d-e)/a),f=Math.round((h-i)/a);(function(k,l,n,s,m,r,j,q,p){(m-=q)>n?(SetStyle($(k),{left:m+"px",top:(r-=p)+"px"}),oSym.addTask(j,arguments.callee,[k,l,n,s,m,r,j+=0.3,q,p])):(SetStyle($(k),{left:n+"px",top:s+"px"}),delete ArSun[k],oSym.addTask(20,ClearChild,[$(k)]))})(b,c,e,i,d,h,1,g,f)},AutoClickSun=function(){var a,b;for(b in ArSun){ArSun[b].C&&ClickSun(b)}},ShowLargeWave=function(){NewImg("LargeWave","images/LargeWave.gif","left:357px;top:283px;z-index:50",1);oSym.addTask(500,ClearChild,[$("LargeWave")])},ShowFinalWave=function(){NewImg("FinalWave","images/LargeWave.gif","left:357px;top:283px;z-index:50",1);oSym.addTask(500,function(){EditImg($("FinalWave"),"","images/FinalWave.gif",{left:"374px",top:"265px",width:"252px",height:"71px",display:"none"});oSym.addTask(100,function(){SetBlock($("FinalWave"));oSym.addTask(150,ClearChild,[$("FinalWave")])},[])},[])},LawnMowerKill=function(b){var e="LawnMower"+b,c=$(e),d=oS.LawnMowerX,a=oS.W;oGd.$LM[b]=0;(function(){var g=oZ.getArZ(d,d+50,b),f=g.length;while(f--){g[f].Die(2)}(d+=10)>a?ClearChild(c):(c.style.left=d+"px",oSym.addTask(1,arguments.callee,[]))})()},GameOver=function(){NewImg("iGameOver","images/ZombiesWon.png","width:900px;height:600px;z-index:255",1,{onclick:function(){SelectModal(JSPVZ)}})},PrepareGrowPlants=function(a){NewImg("PrepareGrow","images/PrepareGrowPlants.gif#"+Math.random(),"z-index:50;left:"+(oS.W*0.5-77)+"px;top:"+(oS.H*0.5-54)+"px",1);oSym.addTask(250,function(){ClearChild($("PrepareGrow"));a()},[])},CustomPlants=function(b,a,c){(new ArCard[b].PName).Birth(GetX(c),GetY(a),a,c,[])};CheckAutoSun=function(a){var b=a.checked?1:0;b!=AutoSun&&(addCookie("JSPVZAutoSun",AutoSun=b),b&&AutoClickSun())},GetNewCard=function(a,b,c){oSym.Clear();SetStyle(a,{left:"350px",top:"131px",width:"200px",height:"120px",cursor:"default"});a.onclick=null;NewEle("DivA","div","width:900px;height:600px;background:#FFF;z-index:255",0,1);oSym.Init(function(d,e){++d<100?(SetAlpha(e,d,d*0.01),oSym.addTask(1,arguments.callee,[d,e])):function(){SetHidden(obDAll,$("dTop"));var f=b.prototype;$("iNewPlantCard").src=f.PicArr[f.NormalGif];$("iNewPlantCard").style.marginTop=180-f.height+"px";innerText($("dNewPlantName"),f.CName);$("dNewPlantTooltip").innerHTML=f.Tooltip;$("btnNextLevel").onclick=function(){c==10&&(c=0,alert("还没做好，敬请期待！"));SelectModal(c)};SetStyle($("dNewPlant"),{display:"block",zIndex:255});oSym.Stop()}()},[0,$("DivA")])},getCookie=function(b){var d=document.cookie,e=d.split(";"),c=e.length,a;while(c--){if((a=e[c].split("="))[0].replace(" ","")==b){return a[1]}}return 0},addCookie=function(a,c,d){var b=a+"="+escape(c);document.cookie=b},deleteCookie=function(a){document.cookie=a+"=0;"},WordUTF8='<div id="dLogo" style="position:absolute;width:900px;height:600px;background:#000 url(images/Logo.jpg) no-repeat;z-index:1"><span style="position:absolute;line-height:1.5;left:349px;top:10px;width:524px;text-align:right;font-size:15pt; font-family:&#x9ED1;&#x4F53;;color:#F60; top:32px">&#x6B22;&#x8FCE;&#x6765;&#x5230;<span style="font-family:Verdana">LonelyStar</span>&#x7684;<span style="font-family:Verdana">JavaScript</span>&#x7248;&#x690D;&#x7269;&#x5927;&#x6218;&#x50F5;&#x5C38;<br>&#x5728;&#x7EBF;&#x7F51;&#x5740; <span style="font-family:Verdana">http://pvz.lonelystar.org/</span><br><b>&#x7A0B;&#x5E8F;&#x7684;&#x5F00;&#x53D1;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5B66;&#x4E60;&#xFF0C;&#x6240;&#x6709;&#x7248;&#x6743;&#x5F52;PopCap&#x6240;&#x6709;</b></span><div id="LogoWord" style="position:absolute;color:#FF0;top:510px;width:100%;height:90px"><span style="position:absolute;font-size:15pt;width:321px;height:69px; font-family:&#x9ED1;&#x4F53;;line-height:69px; left:60px; top:10px;cursor:pointer;background:url(images/interface/LogoLine.png) no-repeat center -5px;text-align:center" onclick="SetBlock($(\'dSelectModal\'))">&#x70B9;&#x51FB;&#x5F00;&#x59CB;<span style="font-size:15pt; font-family:Verdana;color:#FF0;cursor:pointer;">JavaScript</span>&#x7248;&#x3002;&#x3002;&#x3002;</span><span style="position:absolute;font-size:11pt;left:407px;top:29px;line-height:1.5;font-weight:bold"><span style="cursor:pointer;" onclick="SetBlock($(\'dProcess\'))">&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x66F4;&#x65B0;&#x8FDB;&#x5EA6;&#x5217;&#x8868;!<span id="sTime"></span></span><br><a target="_blank" style="cursor:pointer;color:#FF0;" href="http://www.lonelystar.org/view/Index.asp">&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5230;&#x7F51;&#x7AD9;&#x7559;&#x8A00;&#x677F;&#x7559;&#x8A00;&#xFF0C;&#x8C22;&#x8C22;&#x3002;(&#x65E0;&#x9700;&#x6CE8;&#x518C;&#x767B;&#x9646;)</a></span></div></div>',CheckLvl=function(){$User.HTTP?($("JSPVZ").src="level/"+(JSPVZ=getCookie("JSPVZ"))+".js",deleteCookie("JSPVZ")):(JSPVZ=location.search.substr(1),!JSPVZ&&(JSPVZ=0),$("JSPVZ").src="level/"+JSPVZ+".js")},SelectModal=function(a){innerText($("tdModalStr"),"载入中,如速度缓慢非程序原因,请体谅！");$User.HTTP?(addCookie("JSPVZ",a),location.reload()):location.replace("?"+a)},PauseGame=function(b){var a=oSym;a.Timer?(a.Stop(),innerText(b,"回到游戏")):(a.Start(),innerText(b,"暂停游戏"))},$=function(a){return document.getElementById(a)},$n=function(a){return document.createElement(a)},ClearChild=function(){var a=arguments.length,c;while(a--){try{c=arguments[a];c.parentNode.removeChild(c);c=null}catch(b){}}},SetBlock=function(){var a=arguments.length;while(a--){arguments[a].style.display="block"}},SetNone=function(){var a=arguments.length;while(a--){arguments[a].style.display="none"}},SetHidden=function(){var a=arguments.length;while(a--){arguments[a].style.visibility="hidden"}},SetVisible=function(){var a=arguments.length;while(a--){arguments[a].style.visibility="visible"}},SetAlpha=function(c,b,a){c.style.filter="alpha(opacity="+b+")";c.style.opacity=a},SetStyle=function(d,b){var c=d.style,a;for(a in b){c[a]=b[a]}return d},NewImg=function(f,e,c,a,d){var b=$n("img");b.src=e;c&&(b.style.cssText=c);if(d){for(v in d){b[v]=d[v]}}f&&(b.id=f);a&&obDAll.appendChild(b);return b},EditImg=function(e,f,c,b,a){f&&(e.id=f);c&&(e.src=c);b&&SetStyle(e,b);a&&obDAll.appendChild(e);return e},NewEle=function(h,c,e,b,a,f,g,d){g=$n(c);h&&(g.id=h);e&&(g.style.cssText=e);if(b){for(d in b){g[d]=b[d]}}if(f){for(d in f){g.setAttribute(d,f[d])}}a&&obDAll.appendChild(g);return g},EditEle=function(g,f,b,a,c,e){if(f){for(e in f){g.setAttribute(e,f[e])}}b&&SetStyle(g,b);if(c){for(e in c){g[e]=c[e]}}a&&obDAll.appendChild(g);return g},NewO=function(b,a){return(a=function(){}).prototype=b,a},SetPrototype=function(d,c,a){a=d.prototype;for(var b in c){a[b]=c[b]}},InheritO=function(d,i,c,g,b,h,f,e,a){var g=function(){};g.prototype=new d;i&&SetPrototype(g,i);if(c){a=g.prototype;for(f in c){b=a[f].slice(0);h=c[f];for(e in h){b[e]=h[e]}g.prototype[f]=b}}return g},Compare=function(e,b,a,c,d){return d=e<b?b:e>a?a:e,c?[c(d),d]:[d]},$Switch=function(h,d,c,a,g,b,e){b=0;g=d.length;e=c;while(b<g){if(e(h,d[b])){break}++b}return a[b]},$SEql=function(d,c,a,b){return(a=c[d])!=b?a:c["default"]};$SSml=function(d,c,a){var b=0;LX=c.length;while(b<LX){if(d<c[b]){break}++b}return a[b]},$SGrt=function(d,c,a){var b=0;LX=c.length;while(b<LX){if(d>c[b]){break}++b}return a[b]},ImgSpriter=function(g,b,d,e,f){var a=d[e],c=a[2];$(g).style.backgroundPosition=a[0];oSym.addTask(a[1]*0.1,function(h){h>-1?ImgSpriter(g,b,d,h,f):f(g,b)},[c])},$f=function(a){return new Function("a","b","return("+a+")")};